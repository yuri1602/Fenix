@echo off
chcp 65001 >nul
cls
echo ============================================================
echo    üéì FENIX - –ò–Ω—Å—Ç–∞–ª–∞—Ü–∏—è –Ω–∞ —Å–∏—Å—Ç–µ–º–∞—Ç–∞
echo ============================================================
echo.
echo –¢–æ–∑–∏ —Å–∫—Ä–∏–ø—Ç —â–µ –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞ –≤—Å–∏—á–∫–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏
echo –∑–∞ –¥–∞ –º–æ–∂–µ –¥–∞ —Ä–∞–±–æ—Ç–∏ Fenix —Å–∏—Å—Ç–µ–º–∞—Ç–∞.
echo.
echo ============================================================
echo.

REM –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–ª–∏ —Å–∫—Ä–∏–ø—Ç—ä—Ç —Å–µ –∏–∑–ø—ä–ª–Ω—è–≤–∞ –æ—Ç –ø—Ä–∞–≤–∏–ª–Ω–∞—Ç–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
if not exist "app.py" (
    echo ‚ùå –ì–†–ï–®–ö–ê: –ù–µ –º–æ–≥–∞ –¥–∞ –Ω–∞–º–µ—Ä—è app.py —Ñ–∞–π–ª–∞!
    echo.
    echo –ú–æ–ª—è —Å—Ç–∞—Ä—Ç–∏—Ä–∞–π—Ç–µ —Ç–æ–∑–∏ —Å–∫—Ä–∏–ø—Ç –æ—Ç –ø–∞–ø–∫–∞—Ç–∞ –Ω–∞ –ø—Ä–æ–µ–∫—Ç–∞ Fenix.
    echo.
    pause
    exit /b 1
)

echo üìã –°—Ç—ä–ø–∫–∞ 1/4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ Python...
echo ============================================================
echo.

REM –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–ª–∏ Python –µ –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω
python --version >nul 2>&1
if errorlevel 1 (
    echo ‚ùå Python –ù–ï –µ –Ω–∞–º–µ—Ä–µ–Ω –Ω–∞ —Ç–æ–∑–∏ –∫–æ–º–ø—é—Ç—ä—Ä!
    echo.
    echo üì• –ú–æ–ª—è –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞–π—Ç–µ Python –ø—Ä–µ–¥–∏ –¥–∞ –ø—Ä–æ–¥—ä–ª–∂–∏—Ç–µ:
    echo.
    echo    1. –û—Ç–≤–æ—Ä–µ—Ç–µ: https://www.python.org/downloads/
    echo    2. –ò–∑—Ç–µ–≥–ª–µ—Ç–µ –Ω–∞–π-–Ω–æ–≤–∞—Ç–∞ –≤–µ—Ä—Å–∏—è –Ω–∞ Python
    echo    3. ‚ö†Ô∏è  –í–ê–ñ–ù–û: –ü—Ä–∏ –∏–Ω—Å—Ç–∞–ª–∞—Ü–∏—è –æ—Ç–º–µ—Ç–Ω–µ—Ç–µ "Add Python to PATH"
    echo    4. –°—Ç–∞—Ä—Ç–∏—Ä–∞–π—Ç–µ –æ—Ç–Ω–æ–≤–æ —Ç–æ–∑–∏ —Å–∫—Ä–∏–ø—Ç
    echo.
    echo üåê –û—Ç–≤–∞—Ä—è–Ω–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ç–∞ –∑–∞ –∏–∑—Ç–µ–≥–ª—è–Ω–µ...
    timeout /t 3 >nul
    start https://www.python.org/downloads/
    echo.
    pause
    exit /b 1
)

REM –ü–æ–∫–∞–∑–≤–∞–Ω–µ –Ω–∞ –≤–µ—Ä—Å–∏—è—Ç–∞ –Ω–∞ Python
for /f "tokens=*" %%i in ('python --version') do set PYTHON_VERSION=%%i
echo ‚úÖ %PYTHON_VERSION% –µ –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω!
echo.

echo üìã –°—Ç—ä–ø–∫–∞ 2/4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ pip...
echo ============================================================
echo.

REM –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–ª–∏ pip –µ –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω
python -m pip --version >nul 2>&1
if errorlevel 1 (
    echo ‚ùå pip –Ω–µ –µ –Ω–∞–º–µ—Ä–µ–Ω!
    echo.
    echo üì• –ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω–µ –Ω–∞ pip...
    python -m ensurepip --default-pip
    if errorlevel 1 (
        echo ‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω–µ –Ω–∞ pip!
        pause
        exit /b 1
    )
)

for /f "tokens=*" %%i in ('python -m pip --version') do set PIP_VERSION=%%i
echo ‚úÖ %PIP_VERSION%
echo.

echo üìã –°—Ç—ä–ø–∫–∞ 3/4: –û–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ pip...
echo ============================================================
echo.

python -m pip install --upgrade pip
if errorlevel 1 (
    echo ‚ö†Ô∏è  –ù–µ –º–æ–∂–∞—Ö –¥–∞ –æ–±–Ω–æ–≤—è pip, –Ω–æ —â–µ –ø—Ä–æ–¥—ä–ª–∂–∞ —Å —Ç–µ–∫—É—â–∞—Ç–∞ –≤–µ—Ä—Å–∏—è
) else (
    echo ‚úÖ pip –µ –æ–±–Ω–æ–≤–µ–Ω —É—Å–ø–µ—à–Ω–æ!
)
echo.

echo üìã –°—Ç—ä–ø–∫–∞ 4/4: –ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω–µ –Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏...
echo ============================================================
echo.

REM –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–ª–∏ –∏–º–∞ requirements.txt
if exist "requirements.txt" (
    echo üì¶ –ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω–µ –æ—Ç requirements.txt...
    python -m pip install -r requirements.txt
    if errorlevel 1 (
        echo.
        echo ‚ö†Ô∏è  –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω–µ! –û–ø–∏—Ç–≤–∞–º —Ä—ä—á–Ω–∞ –∏–Ω—Å—Ç–∞–ª–∞—Ü–∏—è...
        goto MANUAL_INSTALL
    )
    echo ‚úÖ –í—Å–∏—á–∫–∏ –ø–∞–∫–µ—Ç–∏ —Å–∞ –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω–∏ –æ—Ç requirements.txt!
    goto CHECK_INSTALL
) else (
    echo ‚ö†Ô∏è  requirements.txt –Ω–µ –µ –Ω–∞–º–µ—Ä–µ–Ω. –†—ä—á–Ω–∞ –∏–Ω—Å—Ç–∞–ª–∞—Ü–∏—è...
    goto MANUAL_INSTALL
)

:MANUAL_INSTALL
echo.
echo üì¶ –ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω–µ –Ω–∞ Flask...
python -m pip install Flask==3.0.0
if errorlevel 1 goto INSTALL_ERROR

echo üì¶ –ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω–µ –Ω–∞ openpyxl...
python -m pip install openpyxl==3.1.2
if errorlevel 1 goto INSTALL_ERROR

echo üì¶ –ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω–µ –Ω–∞ Werkzeug...
python -m pip install Werkzeug==3.0.0
if errorlevel 1 goto INSTALL_ERROR

echo ‚úÖ –í—Å–∏—á–∫–∏ –ø–∞–∫–µ—Ç–∏ —Å–∞ –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω–∏ —Ä—ä—á–Ω–æ!
goto CHECK_INSTALL

:INSTALL_ERROR
echo.
echo ‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω–µ –Ω–∞ –ø–∞–∫–µ—Ç!
echo.
echo –í—ä–∑–º–æ–∂–Ω–∏ –ø—Ä–∏—á–∏–Ω–∏:
echo   - –ù—è–º–∞ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –≤—Ä—ä–∑–∫–∞
echo   - Firewall –±–ª–æ–∫–∏—Ä–∞ pip
echo   - –ù—è–º–∞—Ç–µ –ø—Ä–∞–≤–∞ –∑–∞ –∏–Ω—Å—Ç–∞–ª–∞—Ü–∏—è
echo.
echo –û–ø–∏—Ç–∞–π—Ç–µ –¥–∞ —Å—Ç–∞—Ä—Ç–∏—Ä–∞—Ç–µ Command Prompt –∫–∞—Ç–æ Administrator
echo –∏ –∏–∑–ø—ä–ª–Ω–µ—Ç–µ –æ—Ç–Ω–æ–≤–æ —Ç–æ–∑–∏ —Å–∫—Ä–∏–ø—Ç.
echo.
pause
exit /b 1

:CHECK_INSTALL
echo.
echo üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∏–Ω—Å—Ç–∞–ª–∞—Ü–∏—è—Ç–∞...
echo ============================================================
echo.

REM –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–ª–∏ Flask –µ –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω —É—Å–ø–µ—à–Ω–æ
python -c "import flask; print('‚úÖ Flask ' + flask.__version__)" 2>nul
if errorlevel 1 (
    echo ‚ùå Flask –Ω–µ –µ –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω –ø—Ä–∞–≤–∏–ª–Ω–æ!
    goto INSTALL_ERROR
)

python -c "import openpyxl; print('‚úÖ openpyxl ' + openpyxl.__version__)" 2>nul
if errorlevel 1 (
    echo ‚ùå openpyxl –Ω–µ –µ –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω –ø—Ä–∞–≤–∏–ª–Ω–æ!
    goto INSTALL_ERROR
)

python -c "import werkzeug; print('‚úÖ Werkzeug ' + werkzeug.__version__)" 2>nul
if errorlevel 1 (
    echo ‚ùå Werkzeug –Ω–µ –µ –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω –ø—Ä–∞–≤–∏–ª–Ω–æ!
    goto INSTALL_ERROR
)

echo.
echo ============================================================
echo    ‚úÖ –ò–ù–°–¢–ê–õ–ê–¶–ò–Ø–¢–ê –ó–ê–í–™–†–®–ò –£–°–ü–ï–®–ù–û!
echo ============================================================
echo.
echo –í–∞—à–∞—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –µ –≥–æ—Ç–æ–≤–∞ –∑–∞ –∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ!
echo.
echo üöÄ –ó–∞ –¥–∞ —Å—Ç–∞—Ä—Ç–∏—Ä–∞—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ:
echo    1. –î–≤–æ–µ–Ω –∫–ª–∏–∫ –Ω–∞ start.bat
echo    2. –ò–ª–∏ –æ—Ç–≤–æ—Ä–µ—Ç–µ –±—Ä–∞—É–∑—ä—Ä –Ω–∞: http://localhost:5000
echo.
echo üìö –ü—ä—Ä–≤–æ–Ω–∞—á–∞–ª–Ω–∏ –∫—Ä–µ–¥–µ–Ω—à—ä–ª–∏:
echo    –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª: admin
echo    –ü–∞—Ä–æ–ª–∞: admin
echo.
echo ‚ö†Ô∏è  –ù–µ –∑–∞–±—Ä–∞–≤—è–π—Ç–µ –¥–∞ –ø—Ä–æ–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª–∞—Ç–∞ —Å–ª–µ–¥ –ø—ä—Ä–≤–æ –≤–ª–∏–∑–∞–Ω–µ!
echo.
echo ============================================================
echo.

REM –ü–∏—Ç–∞–Ω–µ –¥–∞–ª–∏ –¥–∞ —Å—Ç–∞—Ä—Ç–∏—Ä–∞ —Å—ä—Ä–≤—ä—Ä–∞ —Å–µ–≥–∞
set /p START_NOW="–ò—Å–∫–∞—Ç–µ –ª–∏ –¥–∞ —Å—Ç–∞—Ä—Ç–∏—Ä–∞—Ç–µ —Å—ä—Ä–≤—ä—Ä–∞ —Å–µ–≥–∞? (Y/N): "
if /i "%START_NOW%"=="Y" (
    echo.
    echo üöÄ –°—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ —Å—ä—Ä–≤—ä—Ä–∞...
    echo.
    timeout /t 2 >nul
    call start.bat
) else (
    echo.
    echo –ú–æ–∂–µ—Ç–µ –¥–∞ —Å—Ç–∞—Ä—Ç–∏—Ä–∞—Ç–µ —Å—ä—Ä–≤—ä—Ä–∞ –ø–æ-–∫—ä—Å–Ω–æ —Å –¥–≤–æ–µ–Ω –∫–ª–∏–∫ –Ω–∞ start.bat
    echo.
    pause
)
